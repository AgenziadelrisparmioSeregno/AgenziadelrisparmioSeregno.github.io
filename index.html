<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADR | Agenzia del Risparmio Seregno</title>
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="logo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css?v=1.4">
</head>
<body>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <div class="market-ticker">
        <div class="ticker-content">
            <span class="ticker-item">âš¡ LUCE PUN: 0.123 â‚¬/kWh</span>
            <span class="ticker-item">ðŸ”¥ GAS PSV: 0.328 â‚¬/smc</span>
            <span class="ticker-item">ðŸ“± FIBRA: 2.5GB ATTIVA</span>
            <span class="ticker-item">ðŸ“‰ TREND: RISPARMIO ATTIVO 2026</span>
            <span class="ticker-item">âš¡ LUCE PUN: 0.123 â‚¬/kWh</span>
        </div>
    </div>

    <nav>
        <a href="index.html"><img src="logo.png" alt="ADR Logo" class="nav-logo"></a>
        <div class="nav-links">
            <a href="index.html" class="active">HOME</a>
            <a href="telefonia.html">TELEFONIA</a>
            <a href="fotovoltaico.html">FOTOVOLTAICO</a>
            <a href="caf.html">CAF</a>
            <a href="contatti.html">CONTATTI</a>
        </div>
        <a href="dashboard.html" class="area-clienti-btn">AREA CLIENTI</a>
    </nav>

    <div class="container">
        <header style="text-align: center; margin: 60px 0;" class="reveal">
            <h1 class="tech-font" style="font-size: 2.5rem; margin-top: 10px;">AGENZIA DEL <span style="color:var(--adr-blue)">RISPARMIO</span></h1>
            <p style="color: #666; font-weight: 300;">Consulenza Energetica e Digitale Avanzata a Seregno</p>
        </header>

        <div class="glass-card reveal">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 40px; align-items: center;">
                <div>
                    <h3 class="tech-font">Scanner Bolletta IA</h3>
                    <div id="ui-home-default">
                        <input type="file" id="file-input-home" style="display: none;" onchange="eseguiScansioneHome()">
                        <button class="btn" onclick="document.getElementById('file-input-home').click()">CARICA PDF BOLLETTA</button>
                        <p style="text-align: center; font-size: 0.6rem; color: #555; margin: 10px 0;">OPPURE</p>
                        <button class="btn btn-andrea" onclick="vaiWhatsApp('Andrea', 'consulenza_generale')">PRENOTA CONSULENZA GRATUITA</button>
                    </div>

                    <div id="ui-home-risultato" style="display: none; text-align: center;">
                        <div class="grade-circle">4</div>
                        <p class="tech-font" style="color:#ff4444; font-size: 0.7rem; margin-bottom: 15px;">VOTO INSUFFICIENTE</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn" onclick="vaiWhatsApp('Daniel', 'bolletta')">DANIEL</button>
                            <button class="btn" onclick="vaiWhatsApp('Daniele', 'bolletta')">DANIELE</button>
                            <button class="btn" onclick="vaiWhatsApp('Luca', 'bolletta')">LUCA</button>
                            <button class="btn btn-andrea" onclick="vaiWhatsApp('Andrea', 'bolletta')">ANDREA</button>
                        </div>
                    </div>
                </div>

                <div id="drop-zone" onclick="document.getElementById('file-input-home').click()">
                    <p id="label-home" style="font-size: 0.75rem; color: #666;">
                        <span style="font-size: 2.5rem; display: block; margin-bottom: 10px;">ðŸ“„</span>
                        <b style="color: var(--adr-blue)">CLICCA</b> PER ANALIZZARE PDF
                    </p>
                </div>
            </div>
        </div>

        <div class="reveal" style="margin-top: 80px;">
            <h2 class="tech-font" style="text-align: center; font-size: 1rem; color: #666; margin-bottom: 10px;">Collaboriamo con i <span style="color: var(--adr-blue)">Migliori Brand</span></h2>
            <div class="partner-container">
                <div class="partner-track">
                    <img src="logo-acea.png" class="partner-logo" alt="Acea"><img src="logo-hera.png" class="partner-logo" alt="Hera">
                    <img src="logo-eon.png" class="partner-logo" alt="Eon"><img src="logo-enel.png" class="partner-logo" alt="Enel">
                    <img src="logo-audax.png" class="partner-logo" alt="Audax"><img src="logo-bluenergy.png" class="partner-logo" alt="Bluenergy">
                    <img src="logo-segnoverde.png" class="partner-logo" alt="Segnoverde"><img src="logo-fastweb-energia.png" class="partner-logo" alt="Fastweb Energia">
                </div>
            </div>
        </div>
    </div>

    <div id="bot-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
        <div id="bot-launcher" onclick="toggleBot()" style="width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 2rem; background: linear-gradient(145deg, #00b4ff, #008ee6); box-shadow: 0 10px 25px rgba(0,168,255,0.3);">ðŸ¤–</div>
        
        <div id="bot-window">
            <div class="bot-header">
                <span>ðŸ¤– ADR-1 ASSISTENTE ENERGETICO IA</span>
                <span onclick="toggleBot()" style="cursor: pointer; font-size: 1.2rem;">&times;</span>
            </div>
            <div id="bot-messages">
                <div class="msg-bot">Ciao! Sono ADR-1, il tuo assistente energetico potente. Chiedimi qualunque cosa, anche le basi! Se avrai un problema che non posso risolvere, ti passerÃ² ai miei esperti umani.</div>
            </div>
            <div class="bot-input-area">
                <input type="text" id="user-input" placeholder="Scrivi qui la tua domanda..." onkeypress="if(event.key==='Enter') inviaMessaggioBot()">
                <button class="bot-send-btn" onclick="inviaMessaggioBot()">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <footer style="text-align: center; padding: 40px; margin-top: 50px;">
        <p style="font-size: 0.6rem; color: #aaa;">Â© 2026 ADR SEREGNO - SISTEMA DI RISPARMIO CERTIFICATO</p>
    </footer>

    <script>
        let resocontoChat = [];
        // Costanti per risposte rapide del bot
        const VALORI_MERCATO = { pun: "0.123 â‚¬/kWh", psv: "0.328 â‚¬/smc" };

        async function inviaMessaggioBot() {
            const input = document.getElementById('user-input');
            const msgContainer = document.getElementById('bot-messages');
            const testoUtente = input.value.trim();

            if (testoUtente === "") return;

            resocontoChat.push("Cliente: " + testoUtente);
            msgContainer.innerHTML += `<div class="msg-user">${testoUtente}</div>`;
            input.value = "";
            msgContainer.scrollTop = msgContainer.scrollHeight;

            const tid = "t-" + Date.now();
            msgContainer.innerHTML += `<div id="${tid}" class="msg-bot"><i>ðŸ”Ž Sto elaborando una risposta professionale...</i></div>`;
            msgContainer.scrollTop = msgContainer.scrollHeight;

            try {
                const t = testoUtente.toLowerCase();
                let rispostaIA = "";
                let mostraUmano = false;

                // LOGICA RISPOSTE DIRETTE PUN / PSV
                if (t.includes("pun")) {
                    rispostaIA = `Il valore del <b>PUN (Luce)</b> di oggi Ã¨ di <b>${VALORI_MERCATO.pun}</b>. ADR monitora costantemente questi indici per garantirti il massimo risparmio.`;
                } else if (t.includes("psv")) {
                    rispostaIA = `Il valore del <b>PSV (Gas)</b> di oggi Ã¨ di <b>${VALORI_MERCATO.psv}</b>. Questo Ã¨ l'indice di riferimento per il mercato libero in Italia.`;
                }
                // LOGICA SMISTAMENTO PROBLEMI
                else if (t.includes("problema") || t.includes("aiuto") || t.includes("operatore") || t.includes("parlare") || t.includes("non funziona")) {
                    rispostaIA = "Capisco che la situazione richiede un'analisi umana dettagliata. Ecco i miei superiori che possono risolvere il tuo problema specifico:";
                    mostraUmano = true;
                } else {
                    // Ricerca web
                    const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(testoUtente)}&format=json&no_html=1&skip_disambig=1`);
                    const data = await response.json();
                    
                    if (data.AbstractText && data.AbstractText !== "") {
                        rispostaIA = "<b>Ecco le informazioni tecniche:</b><br>" + data.AbstractText;
                    } else {
                        // Domande energetiche basi
                        if (t.includes("luce") || t.includes("gas") || t.includes("bolletta")) {
                            rispostaIA = "Il mercato energetico si basa su indici come PUN e PSV. Noi di ADR analizziamo la tua spesa per ridurla. Se vuoi un'analisi del tuo caso, chiedi pure dei nostri esperti!";
                        } else if (t.includes("costa") || t.includes("pagare")) {
                            rispostaIA = "I costi variano in base al fornitore. La consulenza di ADR Ã¨ gratuita: troviamo il brand migliore tra Enel, Acea, Hera e altri per farti pagare meno.";
                        } else {
                            rispostaIA = "Questa Ã¨ una domanda specifica che richiede l'attenzione dei nostri specialisti umani per evitare errori nei calcoli.";
                            mostraUmano = true;
                        }
                    }
                }

                document.getElementById(tid).remove();
                resocontoChat.push("Bot: " + rispostaIA.replace(/<[^>]*>/g, ''));

                let html = `<div class="msg-bot">${rispostaIA}`;
                if (mostraUmano) {
                    html += `
                    <div style="margin-top: 15px; border-top: 2px solid var(--adr-blue); padding-top: 10px;">
                        <p style="font-size: 0.7rem; font-weight: bold; color: var(--adr-blue);">Scegli l'esperto per risolvere il tuo problema:</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 8px;">
                            <button class="btn" style="font-size: 0.6rem; padding: 5px;" onclick="vaiWhatsApp('Andrea', 'sos_chat')">ANDREA</button>
                            <button class="btn" style="font-size: 0.6rem; padding: 5px;" onclick="vaiWhatsApp('Daniel', 'sos_chat')">DANIEL</button>
                            <button class="btn" style="font-size: 0.6rem; padding: 5px;" onclick="vaiWhatsApp('Daniele', 'sos_chat')">DANIELE</button>
                            <button class="btn" style="font-size: 0.6rem; padding: 5px;" onclick="vaiWhatsApp('Luca', 'sos_chat')">LUCA</button>
                        </div>
                    </div>`;
                }
                html += `</div>`;
                msgContainer.innerHTML += html;

            } catch (e) {
                document.getElementById(tid).innerHTML = "Errore di rete. Contattaci direttamente tramite i tasti WhatsApp.";
            }
            msgContainer.scrollTop = msgContainer.scrollHeight;
        }

        function toggleBot() {
            const win = document.getElementById('bot-window');
            win.style.display = (win.style.display === 'none' || win.style.display === '') ? 'flex' : 'none';
        }

        function vaiWhatsApp(agente, motivo) {
            const numeri = { 'Daniel': '393423218269', 'Daniele': '393491795387', 'Luca': '393277545377', 'Andrea': '393515910955' };
            let msg = "";
            
            if (motivo === 'sos_chat') {
                const log = resocontoChat.slice(-3).join(" | ");
                msg = `Ciao ${agente}, il bot ADR-1 mi ha suggerito di parlare con te. RESOCONTO CHAT: [${log}]. Mi aiuti?`;
            } else if (motivo === 'bolletta') {
                msg = `Ciao ${agente}, ho scansionato la bolletta e il voto Ã¨ INSUFFICIENTE. Mi aiuti?`;
            } else {
                msg = `Ciao ${agente}, vorrei una consulenza professionale ADR.`;
            }
            
            window.open(`https://wa.me/${numeri[agente]}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function eseguiScansioneHome() {
            document.getElementById('label-home').innerHTML = "ANALISI...";
            setTimeout(() => {
                document.getElementById('ui-home-default').style.display = "none";
                document.getElementById('ui-home-risultato').style.display = "block";
            }, 2000);
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((e) => { if(e.isIntersecting) { e.target.style.opacity = "1"; e.target.style.transform = "translateY(0)"; }});
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach((el) => observer.observe(el));

        window.onscroll = function() {
            let scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            if(document.getElementById("progress-bar")) document.getElementById("progress-bar").style.width = scrolled + "%";
        };
    </script>
</body>
</html>
